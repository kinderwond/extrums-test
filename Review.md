# Express.js project code review

#### Repository link: https://github.com/BHARATH999999/backend/tree/7ef9267c25192203716811998f47d9232dc5cb89

### Загальні зауваження:
1) Відсутність тестів. (Бажано мати в якості документації та для майбутнього рефакторингу)
2) Абсолютна відсутність валідації реквестів. (critical)
3) Відсутність лінтера, якщо підключити другого розробника в команду, 
     то в майбутньому можуть виникнути конфлікти якщо притримуватися Git glow.
4) Відсутність документації (не критично)
5) назви хендлерів реквестів мають надлишкові назви. Відкриваємо будь-який контролер 
й бачимо список функції {action}Controller. За дядьком Бобом це запах евристичного коду.
6) Уся бізнес логіка знаходиться в контролерах https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/controller/authController.js 
    (не критично проте складно буде масштабувати)
7) Відсутність uuid. Робота напряму з id БД не є секʼюрним рішенням.
8) Відсутність єдиного формату респонсу помилки.
9) Відсутність скриптів запуску в package.json.
10) Деякі конфігурації захардкожені, що ускладнює розгортання сервера з динамічним environment. 

### Точкові зауваження/мінуси:
1) imageController https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/utilities/mailSender.js <br />
   1.1) Картинки зберігаютьяс в базі.
     Функція createImageController. Головний недолік - неможливо завантажувати великі картинки. Рішення:
       - розбити картинку по частинам й відправляти в якості буфера.
       - на стороні сервера реалізувати функціонал завантаження частинами на S3 (Multipart upload).
       - зберігати в базі посилання на ref картинки на S3. <br />
   1.2) Незрозуміло multer робить в контролері, а не в ядрі сервера. 
2) authController https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/controller/authController.js <br />
    2.1) Функція signupController. Відсутність перевірки даних юзера на унікальність (email, phone number). Пароль в базі незахешований  і це критично.  <br /> 
    2.2) Функція loginController. Наявність розгалуження ускладнює читання та розуміння коду <br />
    2.3) Функція resetPasswordController.  
        &nbsp; &nbsp; 2.3.1) Розгалуження (див п. 2.2). <br />
        &nbsp; &nbsp; 2.3.2) res.status(200).json({  message:"OTP does not match" }). Чому 200 статус якщо це exception??? Має бути 4xx статус код. <br />
   2.4) Функція protectRoute. res.send("You are not logged in. Kindly login"). Відсутність явно вказаного статус кода означає що клієнту прийде респонс 200 і це помилка. Також відправка текстом замість json ненайкраще рішення.
3) imageUploader. https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/controller/imageUploader.js <br />
    3.1) наявність мультера(п.1.2). Пропозиція покращення коду:
    - функціонал завантаження картинки можна зробити динамічним й помістити в один файл (наприклад imageController). 
4) userController. https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/controller/userController.js <br />
    4.1) Функція getAllUsersController. Відсутність пагінації. <br />
    4.2) Функція profilePicUploader. Наявність створення API endpoint'ів (app.post) - змінна app не є глобальною тож це викличе помилки. 
5) mailSender. https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/utilities/mailSender.js <br />
    5.1) Відсутність динамічної конфігурації 
    5.2) const password = require("../model/raw/secrets"). Такий файл відсутній в репозиторії, якщо це приватний файл то його слід додати в .gitignore та в markdown вказати що треба створити такий файл.


### Плюси:
1) Є яка-ніяка документація: https://github.com/BHARATH999999/backend/blob/7ef9267c25192203716811998f47d9232dc5cb89/FoodAppBackend/model/raw/project_desc.md

### Пропозиції щодо покращення якості проекту:

Step 1) Додати скрипти запуску проекту <br />
Step 2) Перенести документацію API в корінь сервера <br />
Step 3) Поки проект не розрісся налаштувати динамічні конфіги в залежності від environment. <br />
Step 4) Налаштувати єдиний формат error handling. Express дозволяє глоабально додати останній мідлвар в якості error handler'a. Тоді можна позбутися try catch в контролерах <br />
Step 5) Навести лад з наступними пунктами з розділу Точкові зауваження/мінуси: 1.2 , 2.1 , 2.3 , 3.1 , 4.2 , 5.2  <br />
Step 6) Почати додавати валідацію реквестів (joi, ajv). Визначити критичні і некритичні ендпоінти та почати з перших. <br /> 
Step 7) Почати рефакторити контролери, а саме:
- Переписати код на архітектуру на кшталт Nest.js без DI контейнера. Це потрібно задля створення слоїв та розподілення відповідальності між ними.  
- Винести роботу з third-party services/libriaries в окремі файли. В майбутньому це дозволить швидко змінювати бібліотеки/сервіси. 
Step 8) додати та налаштувати eslint + prettier.
Step 9) Встановити pre commit hook library - husky та бібліотеку для тестів. Налаштувати pre commit за допомогою husky для валідації проекту перед пушом в репозиторій. 
